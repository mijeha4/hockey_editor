@startuml Диаграмма переходов состояний системы анализа видеоматериалов
!theme plain
title Диаграмма переходов состояний: Система анализа хоккейных матчей

' ================== АВТОМАТ СОЗДАНИЯ СОБЫТИЙ ==================
state "Автомат создания событий анализа" as EventCreation {

    [*] --> Ожидание_команды

    state Ожидание_команды as "Ожидание команды\n• Система готова к приему команд\n• Ожидание действий пользователя"
    state Активная_запись as "Активная запись\n• Выполняется фиксация временного интервала\n• Отображение индикатора записи"
    state Сегмент_зафиксирован as "Сегмент зафиксирован\n• Временной интервал определен\n• Сегмент сохранен в коллекции"

    Ожидание_команды --> Активная_запись : Нажатие горячей клавиши события\n[первое нажатие A/D/S]
    note right
      **Инициация фиксации**
      • Запись начального кадра
      • Установка типа события
      • Визуальная индикация
    end note

    Активная_запись --> Активная_запись : Обновление кадра\n[при воспроизведении видео]
    note right
      **Обновление текущего кадра**
      • Фиксация позиции
      • Обновление индикатора
    end note

    Активная_запись --> Сегмент_зафиксирован : Нажатие горячей клавиши события\n[повторное нажатие той же клавиши]
    note right
      **Завершение фиксации**
      • Расчет границ сегмента
      • Создание объекта сегмента
      • Автоматическая перемотка
    end note

    Активная_запись --> Ожидание_команды : Отмена операции\n[нажатие ESC]
    note right
      **Сброс состояния**
      • Прерывание записи
      • Очистка временных данных
    end note

    Сегмент_зафиксирован --> Ожидание_команды : Автоматический сброс\n[по таймеру 500мс]
    note right
      **Сброс состояния**
      • Подготовка к следующей операции
      • Очистка индикаторов
    end note
}

' ================== АВТОМАТ УПРАВЛЕНИЯ ВОСПРОИЗВЕДЕНИЕМ ==================
state "Автомат управления воспроизведением" as VideoPlayback {

    [*] --> Видео_остановлено

    state Видео_остановлено as "Видео остановлено\n• Материал загружен\n• Воспроизведение не выполняется\n• Доступны все операции"
    state Видео_воспроизводится as "Видео воспроизводится\n• Автоматическая смена кадров\n• Таймер активен\n• Ограниченные операции"
    state Видео_на_паузе as "Видео на паузе\n• Остановлено на текущем кадре\n• Возможна перемотка\n• Доступны операции редактирования"
    state Покадровый_режим as "Покадровый режим\n• Ручное управление кадрами\n• Точное позиционирование\n• Подробный анализ"

    Видео_остановлено --> Видео_воспроизводится : Команда воспроизведения\n[нажатие Play/Space]
    Видео_воспроизводится --> Видео_на_паузе : Команда паузы\n[нажатие Pause/Space]
    Видео_на_паузе --> Видео_воспроизводится : Команда воспроизведения\n[нажатие Play/Space]
    Видео_воспроизводится --> Видео_остановлено : Команда остановки\n[нажатие Stop/конец видео]
    Видео_на_паузе --> Видео_остановлено : Команда остановки\n[нажатие Stop]
    Видео_на_паузе --> Покадровый_режим : Покадровое перемещение\n[стрелки влево/вправо]
    Покадровый_режим --> Видео_на_паузе : Завершение перемещения\n[отпуск клавиши]

    note right of Видео_воспроизводится
      **Особенности состояния:**
      • Таймер кадров активен
      • Возможность создания сегментов
      • Ограниченная интерактивность
    end note

    note right of Видео_на_паузе
      **Особенности состояния:**
      • Таймер остановлен
      • Доступно редактирование
      • Возможна точная перемотка
    end note
}

' ================== АВТОМАТ ЖИЗНЕННОГО ЦИКЛА СЕГМЕНТОВ ==================
state "Автомат жизненного цикла сегментов" as SegmentLifecycle {

    [*] --> Сегмент_создан

    state Сегмент_создан as "Сегмент создан\n• Объект сформирован в памяти\n• Не отображен пользователю\n• Временное состояние"
    state Сегмент_отображен as "Сегмент отображен\n• Виден на временной шкале\n• Доступен для взаимодействия\n• Основное состояние"
    state Сегмент_выбран as "Сегмент выбран\n• Выделен для операций\n• Видны элементы управления\n• Готов к редактированию"
    state Сегмент_редактируется as "Сегмент редактируется\n• Открыт режим изменения\n• Активны поля ввода\n• Изменения не сохранены"
    state Сегмент_удален as "Сегмент удален\n• Исключен из коллекции\n• Можно восстановить\n• Временное состояние"

    Сегмент_создан --> Сегмент_отображен : Добавление в коллекцию\n[успешное создание]
    Сегмент_отображен --> Сегмент_выбран : Выбор пользователем\n[клик по сегменту]
    Сегмент_выбран --> Сегмент_редактируется : Команда редактирования\n[двойной клик/меню]
    Сегмент_редактируется --> Сегмент_отображен : Сохранение изменений\n[подтверждение ввода]
    Сегмент_редактируется --> Сегмент_выбран : Отмена редактирования\n[отмена/закрытие]
    Сегмент_выбран --> Сегмент_отображен : Снятие выделения\n[клик в пустое место]
    Сегмент_отображен --> Сегмент_удален : Команда удаления\n[Delete/меню]
    Сегмент_удален --> [*] : Завершение операции\n[подтверждение удаления]

    note right of Сегмент_выбран
      **Особенности состояния:**
      • Визуальное выделение
      • Доступны операции
      • Активны горячие клавиши
    end note

    note right of Сегмент_редактируется
      **Особенности состояния:**
      • Открыто диалоговое окно
      • Валидация вводимых данных
      • Поддержка отмены
    end note
}

' ================== ВЗАИМОСВЯЗИ МЕЖДУ АВТОМАТАМИ ==================
Видео_воспроизводится --> Сегмент_создан : Нажатие горячей клавиши\n[во время просмотра]
Видео_на_паузе --> Сегмент_создан : Нажатие горячей клавиши\n[на паузе]
Покадровый_режим --> Сегмент_создан : Нажатие горячей клавиши\n[при покадровом просмотре]

' ================== ЗАМЕТКИ ==================
note as N1
  **Ключевые особенности системы:**
  • **Интерактивность**: активное взаимодействие с пользователем
  • **Параллельная работа**: автоматы функционируют одновременно
  • **Временные аспекты**: автоматические переходы по таймеру
  • **Обработка ошибок**: возможность отмены операций
end note

note as N2
  **Управляющие воздействия:**
  • **Пользовательские команды**: горячие клавиши, кнопки интерфейса
  • **Системные события**: таймеры, завершение операций
  • **Внешние сигналы**: готовность данных, изменение состояния
end note

@enduml

@startuml Диаграмма деятельности: Создание события (UC2)
!theme plain
title Диаграмма деятельности варианта использования\n"Создание события"

start

:Пользователь просматривает видео;
:Видео воспроизводится в режиме Playing;

if (Нажата горячая клавиша?) then (Да)

  :Определить тип события по клавише\n(например: G - Гол, H - Бросок в створ);
  :Получить текущий кадр воспроизведения;

  if (Режим создания событий?) then (Динамический режим)
    if (Запись уже активна для этого события?) then (Да)
      :Завершить текущую запись;
      :Рассчитать границы сегмента\n(с учетом pre-roll перед началом);
      :Создать маркер события\n(с привязкой к таймлайну);
      :Автоматически перейти к началу сегмента;
      :Показать статус "Запись завершена";
    else (Нет)
      :Начать новую запись события;
      :Установить статус "Идет запись";
      :Показать визуальную индикацию\n(например, мигающий индикатор);
    endif

  else (Фиксированная длина)
    :Рассчитать границы сегмента\n(фиксированная длительность + pre-roll);
    :Создать маркер события\n(с привязкой к таймлайну);
    :Показать статус "Сегмент создан";
    :Автоматически перейти к началу сегмента;
  endif

  :Добавить маркер в коллекцию событий;
  :Обновить отображение таймлайна\n(показать новый сегмент цветной полоской);
  :Отправить сигнал об изменении маркеров\n(для обновления всех связанных компонентов);

else (Нет)
  :Продолжить обычное воспроизведение видео;
endif

:Проверить условия завершения просмотра;

if (Конец видео достигнут?) then (Да)
  :Остановить воспроизведение;
  :Показать финальный кадр;
  stop
else (Нет)
  if (Пользователь нажал Pause/Stop?) then (Да)
    :Остановить воспроизведение;
    :Сохранить текущую позицию;
    stop
  else (Нет)
    :Продолжить цикл просмотра;
    detach
  endif
endif

@enduml

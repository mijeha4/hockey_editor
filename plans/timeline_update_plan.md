# План решения проблемы обновления сегментов на таймлайне

## Анализ проблемы
Сегменты на таймлайне не обновляются при изменениях маркеров из-за отсутствия реактивности в моделях данных. Модели Marker и Project - простые dataclasses без механизмов уведомления об изменениях.

## Выбор подхода
**Частичное обновление** вместо полной перерисовки для лучшей производительности. Обновлять только измененные сегменты, минимизируя перерисовку всего таймлайна.

## Архитектура решения
Использовать паттерн Observable с PySide6 сигналами:
- Observable модели эмитят сигналы при изменениях
- Контроллеры подключаются к сигналам и координируют обновления
- Виды обновляют только необходимые элементы UI

## Необходимые изменения

### Модели данных
#### observable_marker.py (новый файл)
- Класс `ObservableMarker(Marker, QObject)`
- Сигналы:
  - `changed()` - любые изменения
  - `position_changed(int start_frame, int end_frame)`
  - `name_changed(str event_name)`
  - `note_changed(str note)`

#### observable_project.py (новый файл)
- Класс `ObservableProject(Project, QObject)`
- Сигналы:
  - `marker_added(int index, Marker marker)`
  - `marker_removed(int index)`
  - `marker_changed(int index, Marker marker)`
  - `markers_cleared()`

### Контроллеры
#### timeline_controller.py
- Использовать `ObservableProject` вместо `Project`
- Добавить подключение сигналов проекта к методам обновления
- Добавить методы:
  - `on_marker_added(int index, Marker marker)` - обновить timeline и segment_list
  - `on_marker_removed(int index)` - удалить сегмент из timeline и строки из segment_list
  - `on_marker_changed(int index, Marker marker)` - обновить конкретный сегмент

#### instance_edit_controller.py
- При изменениях маркера вызывать соответствующие сигналы observable_marker
- Добавить эмиссию сигналов при сохранении изменений

### Виды
#### timeline.py
- Добавить метод `update_segment(int index)` для частичного обновления одного сегмента
- Метод должен обновлять позицию, размер и цвет сегмента без полной перерисовки

#### segment_list.py
- Добавить метод `update_row(int index)` для обновления одной строки таблицы
- Метод должен обновлять ячейки строки без перестроения всей таблицы

## План реализации по шагам

1. **Создать observable_marker.py**
   - Реализовать класс с сигналами
   - Переопределить сеттеры для эмиссии сигналов

2. **Создать observable_project.py**
   - Реализовать класс с сигналами для списка маркеров
   - Переопределить методы добавления/удаления маркеров для эмиссии сигналов

3. **Обновить timeline_controller.py**
   - Заменить Project на ObservableProject
   - Добавить подключение сигналов в `__init__`
   - Реализовать обработчики сигналов

4. **Обновить instance_edit_controller.py**
   - Добавить эмиссию сигналов при изменениях маркера
   - Интегрировать с observable_marker

5. **Обновить timeline.py**
   - Реализовать `update_segment(int index)`
   - Оптимизировать для частичного обновления

6. **Обновить segment_list.py**
   - Реализовать `update_row(int index)`
   - Обновлять только необходимые ячейки

7. **Тестирование**
   - Проверить обновление при добавлении/удалении/изменении маркеров
   - Измерить производительность с большим количеством сегментов